cd /Applications/XAMPP/xamppfiles/htdocs/wedding/
git add .
git commit -m "プロジェクトをサーバーにアップする"
git push origin main

git add .
git commit -m "招待状の動きの改善、フラップの動きの改善。座席表の操作の改善"
git push origin main

git add .
git commit -m "indexページのモバイル表示改善、FAQのボタンの問題を修正"
git push origin main

git add .
git commit -m "indexページのカウントダウンモバイル表示改善、時間の読み込み問題の改善"
git push origin main

git add .
git commit -m "2人の物語の内容変更"
git push origin main

git add .
git commit -m "ロリポップサーバーでの写真表示問題を修正：パーミッション設定、キャッシュ制御、.htaccess設定、管理ツール追加"
git push origin main

# 変更内容
- ロリポップサーバーで管理画面からアップロードした写真が表示されなくなる問題を修正
- 写真ファイルにパーミッション設定（0644）を追加
- キャッシュ制御のためのHTTPヘッダー設定
- 画像URLにタイムスタンプを追加してキャッシュを回避
- .htaccessファイルを新規作成・設定
- admin/.htaccessを別ファイルとして設定（IP制限を適用）
- JavaScriptの重複関数問題を修正
- 管理画面にパーミッション修正ツールを追加

git add .
git commit -m "サイトをHTTPS化：保護された通信のためのSSL設定"
git push origin main

# 変更内容
- サイトの「保護されていない通信」警告を解決するためにHTTPS化
- .htaccessファイルにHTTPSリダイレクト設定を追加
- HTTP接続を自動的にHTTPSにリダイレクト
- config.phpのサイトURLをhttps://に変更

git add .
git commit -m "デプロイスクリプト修正：uploadsフォルダを保持するように変更"
git push origin main

# 変更内容
- rsyncコマンドのオプションに`--exclude='uploads/'`を追加
- デプロイ時にuploadsフォルダとその中の写真を削除しないように設定
- デプロイ後にuploadsフォルダとサブディレクトリを自動的に作成
- フォルダのパーミッションを755に、ファイルのパーミッションを644に設定

git add .
git commit -m "ダッシュボード表示問題解決"
git push origin main

git add .
git commit -m ".htaccessファイルをデプロイ時に保持する設定を追加"
git push origin main

# 変更内容
- rsyncコマンドの除外設定に`.htaccess`と`admin/.htaccess`を追加
- サーバー上の.htaccessファイルをバックアップする処理を追加
- デプロイ時に.htaccessファイルが存在しない場合、バックアップから復元する処理を実装
- ローカル環境では.htaccessを削除しても、サーバー上のファイルは保持される

git add .
git commit -m "セキュリティー対応"
git push origin main

git add .
git commit -m "よくある質問にリンクを追加"
git push origin main

2024年6月12日
【変更内容】
- 管理画面アクセス制限を環境変数で制御する機能を追加
- admin/.htaccess.templateファイルを作成し、環境変数ADMIN_ACCESS_CONTROLに基づいて制限を適用するように変更
- デプロイスクリプト(.github/workflows/deploy.yml)を修正し、.htaccessファイルを環境に応じて生成するよう改善
- .htpasswdファイルがない場合は自動生成するコードを追加

【目的】
- 開発環境と本番環境で管理画面のアクセス制限を柔軟に切り替えられるようにする
- 結婚式プランナーなど、特定のユーザーが管理画面にアクセスできるように設定を改善
- Basic認証とIPアドレス制限を組み合わせてセキュリティを強化

【コミットID】
9dfc23a

2024年6月13日
【変更内容】
- ルートの.htaccess.templateにadminディレクトリのアクセス制限設定を追加
- 本番環境（SITE_ENVIRONMENT=production）でのみadminディレクトリへのIPアドレス制限が適用されるよう設定

【目的】
- 本番環境でスマートフォンからアクセスした際に発生する403エラーを解決
- 管理画面へのアクセス制限をルートの.htaccessファイルでも適切に設定
- 開発環境と本番環境でのアクセス制限を環境変数で統一的に管理

【コミットID】
6cbab4b

2024年6月14日
【変更内容】
- 管理画面へのスマホアクセスを許可するように設定を修正
- 管理画面の.htaccessファイルにIPアドレス制限を緩和する「open」モードを追加
- デプロイスクリプトでADMIN_ACCESS_CONTROL環境変数を「open」に設定
- ルートの.htaccess.templateからadminディレクトリへのIP制限を削除

【目的】
- スマートフォンから外部で管理画面にアクセスできるようにする
- Basic認証のみのモードを追加し、IP制限なしでも管理画面にアクセスできるようにする
- 管理画面のアクセス制限を一元的に管理（admin/.htaccessで完結）

【コミットID】
216f0f9

2024年6月14日（その2）
【変更内容】
- ベーシック認証のパスワードハッシュを更新
- 新しいハッシュに置き換え（パスワードは同じ）

【目的】
- スマートフォンからのベーシック認証のログイン問題を解決
- ハッシュの互換性問題に対応

【コミットID】
d6b5e06

2024年6月14日（その3）
【変更内容】
- ベーシック認証を完全に無効化
- PHPセッション認証のみを使用するように変更
- .htpasswdファイルを生成する処理を削除
- 管理画面へのアクセス方法を簡素化

【目的】
- スマートフォンからの管理画面アクセスを容易にする
- 結婚式プランナーやその他の管理者が簡単にアクセスできるようにする
- 複数の認証層による混乱を解消し、PHPのセッション認証のみに統一

【コミットID】
828c031

2024年6月14日（その4）
【変更内容】
- デプロイスクリプトのSSH接続設定を修正
- StrictHostKeyChecking設定を「accept-new」から「no」に変更

【目的】
- デプロイ中に発生するRSAキー署名エラーを解決
- サーバー接続時のホスト認証を無効化し、自動デプロイを確実に実行できるようにする

【コミットID】
5fa5c86

2024年6月14日（その5）
【変更内容】
- デプロイスクリプトのパス設定を修正
- 相対パス(~/)から絶対パス(/home/users/1/...)に変更

【目的】
- ディレクトリが見つからないエラーを解決
- サーバー上の正確なパスを指定し、デプロイの安定性を向上

【コミットID】
d2cd78a

git add .
git commit -m "スタイル一部修正、indexページのモバイル表示改善"
git push origin main

git add .
git commit -m "招待状ページ分と管理者ページのモバイル表示改善"
git push origin main

git add .
git commit -m "招待状ページ出席する　しない　ボタンのモバイル表示改善"
git push origin main

git add .
git commit -m "招待状ページのモバイル表示改善、ソプラノハクションの由来の説明の表示改善"
git push origin main

2024年6月14日（その6）
【変更内容】
- デプロイスクリプトを大幅改善
- SSH設定ファイル方式からコマンドライン直接指定方式に変更
- SSH接続テストを追加し、事前に接続確認を行うように修正
- rsyncコマンドのオプションを改善し、接続エラーを回避
- すべてのSSHコマンドに直接接続パラメータを指定

【目的】
- 継続的に発生するデプロイエラーの根本的解決
- SSH接続の安定性向上
- GitHubアクションでのデプロイ成功率向上

【コミットID】
811273d

git add .
git commit -m "ゲストブックページのモバイル表示改善"
git push origin main

2024年6月14日（その7）
【変更内容】
- デプロイスクリプトを完全に簡素化
- SSHコマンドを最小限の構成に変更
- ディレクトリパスを明示的にチェックする処理を追加
- ホームディレクトリからの相対パス(web/sopranohaction)を使用
- 複雑なシェルコマンドを単純化し、catコマンドを使用

【目的】
- 継続的に発生するSSH接続エラーとパス問題の根本的解決
- デプロイプロセスの信頼性向上
- 複雑なシェルコマンドによるエラーを回避

【コミットID】
3325350

git add .
git commit -m "ゲストブックページのモバイル表示改善"
git push origin main

2025年3月25日
【変更内容】
- READMEファイルにGitテストセクションを追加
- 日付を明示的に記載（2025年3月25日）

【目的】
- Gitプッシュとデプロイプロセスのテスト
- GitHub Actionsのワークフロー検証

【コミットID】
c8b57eb

git add .
git commit -m "封筒のタップ指示の位置を変更"
git push origin main     

git add .
git commit -m "招待状ページのゲストブックモバイル表示改善及び管理者ページのゲスト付箋の表示及び操作改善"
git push origin main

2025年3月25日（その2）
【変更内容】
- 管理者ページのゲスト付箋編集機能を修正
- 編集ボタンが本番環境で機能しない問題を解決
- キャッシュ防止のためのメタタグを追加
- JavaScriptにエラー処理とデバッグログを追加
- モーダル表示のロバスト性を向上

【目的】
- 本番環境でのユーザビリティ向上
- JavaScriptの堅牢性向上によるエラー耐性の強化
- デバッグ情報の追加による問題の早期発見

【コミットID】
0467019

git add .
git commit -m "ゲスト付箋編集機能の修正"
git push origin main

git add .
git commit -m "招待状及び管理ページにおける、ブライダル担当の要件に基づき修正"
git push origin main

git add .
git commit -m "管理者ページ交通宿泊URL問題の修正"
git push origin main

git add .
git commit -m "スクロールアニメーションの改善"
git push origin main

git add .
git commit -m "復元"
git push origin main

2025年3月26日
【変更内容】
- 管理ダッシュボードの回答一覧に削除機能を追加
- 削除確認モーダルの実装
- 削除処理時に関連する同伴者情報も一緒に削除するよう実装
- RSVPフォームにGoogle reCAPTCHA v2を導入
- フォーム送信時にreCAPTCHA検証を実装

【目的】
- 本番環境で発生したスパム回答を管理者が削除できるようにする
- スパムボットによる自動送信を防止するためのreCAPTCHA導入
- 回答フォームのセキュリティ強化

【コミットID】
fd197d3

git add .
git commit -m "管理画面に回答削除機能を追加し、フォームにreCAPTCHAを追加"
git push origin main

2025年3月27日
【変更内容】
- thank_you.phpの出席/欠席判定ロジックを修正
  - 誤った変数参照（$guest_info['attending']）を修正
  - 正しい変数（$response_status）を使用するよう変更
- wedding_extension_tasks.mdを更新
  - 完了した機能にチェックマークを付加
  - 実装済みの項目を詳細に記録
  - 発生した問題と解決策をドキュメント化
  - 今後の課題と改善点を追加

【目的】
- 欠席回答者に誤ってQRコード案内が表示される問題を修正
- プロジェクト進捗状況の明確化と実装履歴の記録
- 今後の開発計画の整理

【コミットID】
（コミット後に記入）

git add .
git commit -m "thank_you.phpの欠席判定を修正し、wedding_extension_tasks.mdを更新"
git push origin main

git add .
git commit -m "期限の更新"
git push origin main

git add .
git commit -m "様の削除"
git push origin main

2025年4月13日
【変更内容】
- メール通知機能のバグ修正
  - process_rsvp.phpでのIDバグを修正（guest_idをlast_idに修正）
  - レスポンスデータが取得できた場合のみ通知を送信する条件を追加
  - メールデバッグを有効化し、ログ出力を改善
  - config.phpのSMTP設定をより明確に
- メール送信ログ機能の改善
  - logsディレクトリのパーミッション問題を修正
  - メールデバッグログの詳細化

【目的】
- 管理者宛てのメール通知が送信されない問題を解決
- 出欠回答時の通知システムの信頼性向上
- メール送信のトラブルシューティングを容易にする

【コミットID】
120b335

2025年4月13日（その2）
【変更内容】
- QRコードスキャン後の自動遷移問題を修正
  - admin/checkin.phpのスキャン成功時コールバック処理を改善
  - URLパース処理を強化してトークン抽出の信頼性を向上
  - デバッグ情報の出力を強化
  - my_qrcode.phpのQRコードに自動チェックインパラメータを追加
  - guidance.phpに自動チェックイン機能を実装

【目的】
- 本番環境でQRコードスキャン後の自動遷移が動作しない問題を解決
- QRコードスキャン処理の堅牢性を向上
- ユーザーエクスペリエンスの改善

【ブランチ】
feature/qr-checkin-fix

【コミットID】
0636275

【2024年4月19日】緊急修正：変更の巻き戻し
- コミットID: 2f5ca5a に戻しました
- 変更内容: QRコードスキャン後の自動遷移問題の修正（基本実装）のバージョンに戻す
- 理由: 後続の変更で問題が発生したため、安定した動作バージョンに戻しました

【2024年4月19日】QRコード説明テキストの修正
- コミットID: df7bf7e
- 変更内容:
  - my_qrcode.phpのQRコード説明テキストを修正し、会場受付での使用方法を明確化
  - 「自分でスキャンする」といった誤解を招く表現を削除
  - チェックイン時の流れを説明する新しいセクションを追加
  - guidance.phpにチェックイン完了通知を追加して、チェックイン成功を明示
- 目的: ゲストがQRコードの使用方法を正しく理解できるようにし、受付での混乱を防止する

## 2024年4月17日

### コミット: データベース重複データの削除

- 変更内容:
  - `schedule`テーブルから重複していた「親族集合写真」のデータを削除
  
- 問題: 
  - 11:00の「親族集合写真」イベントが案内ページで重複して表示されていた
  - データベースの`schedule`テーブルに同一内容の行が2つ存在していた（ID 19と20）
  
- 解決策:
  - 重複していたID 20のレコードを削除
  - CSS表示問題も同時に修正（モバイル表示でのレイアウト改善など）

- 目的: 案内ページのスケジュール表示を正確にし、ユーザーエクスペリエンスを向上させる

## 2024年4月17日（その2）

### コミット: スケジュール設定の複数グループ対応

- 変更内容:
  - スケジュール管理画面で複数のグループを対象として選択できるよう機能追加
  - 同一イベントを複数のグループに対して登録可能に変更
  - チェックボックス選択式のグループ指定UIに改善
  - 「すべてのゲスト」と特定グループの選択を簡単に切り替え可能
  - 場所情報の入力フィールドを追加

- 問題: 
  - これまでは1つのイベントに対して1つのグループしか指定できなかった
  - 同じイベント（例：親族集合写真）を複数の異なるグループに表示したい場合に不便
  
- 解決策:
  - 複数グループを選択できるチェックボックスUIを実装
  - データベースには選択したグループごとに個別レコードとして保存
  - 同じイベント名・時間で複数のグループ向けデータを管理

- 目的: 同じ時間のイベントを複数のグループに対して簡単に設定できるようにし、スケジュール管理を効率化

# 2025/04/15 (マージ) - グループ回答処理の改善機能をメインブランチに統合

コミットID: 2c32d2b
作成者: 村岡翔
コミット日時: 2025年4月15日

## 変更内容
- `index.php`ファイルの改修
  - 既に回答済みのグループには専用メッセージを表示するよう修正
  - フォーム表示／非表示の制御強化
  - URLパラメータによる状態表示の改善

- `process_rsvp.php`ファイルの改修
  - グループIDを利用した重複回答チェックの強化
  - 回答処理のロジック改善
  - エラーハンドリングの強化

## 目的
グループによる回答処理を改善し、既に回答済みのグループには専用メッセージを表示することで、
ユーザー体験を向上させると同時に、重複回答によるデータの不整合を防止する。

## 2024年4月17日（その3）

### コミット: チェックボックスのレイアウト問題を修正

- 変更内容:
  - スケジュール管理画面のグループ選択チェックボックスのレイアウトを改善
  - チェックボックスとラベルの配置を適切に調整
  - チェックボックスのサイズを拡大し視認性を向上
  - ホバー効果の追加とグループ化された視覚的階層の改善
  - カラー表示の調整（全体向けと特定グループ向けで色分け）

- 問題: 
  - チェックボックスとラベルテキストがずれており、どの項目を選択しているか分かりづらかった
  - チェックボックスの操作性が悪く、モバイル表示で特に問題が顕著だった
  
- 解決策:
  - CSS改善によるチェックボックスとラベルの適切な配置
  - flexbox布局の採用によるレイアウト安定化
  - より大きなクリック領域の確保とビジュアル的な区分けの明確化

- 目的: 複数グループ選択UIの使いやすさと視認性を向上させ、管理者が直感的に操作できるようにする

## 2024年4月18日

### コミット: QRコードチェックインフローを改善

- 変更内容:
  - QRコードスキャン後のフローを簡素化：ガイダンスページを経由せず直接招待状ページに戻るよう変更
  - チェックイン完了メッセージを招待状ページに統合
  - QRコードのリンク先をguidance.phpからindex.phpに変更
  - チェックイン処理をindex.phpに追加
  - push_notification.phpのデフォルトアクションを更新

- 問題: 
  - 現在のフローではQRコードスキャン後にガイダンスページに移動し、さらに招待状に戻る必要があった
  - ガイダンスページで表示される情報は招待状ページで既に提供されていて冗長だった
  - ユーザーが複数のページを行き来する必要があり、使い勝手が悪かった
  
- 解決策:
  - QRコードをスキャンした後、直接招待状ページに戻るように変更
  - チェックイン完了状態を表示するメッセージを招待状ページに追加
  - QRコードのURL生成処理を修正して、グループIDとトークンを含めるように変更

- 目的: ユーザーエクスペリエンスの向上と、より直感的なフローの実現

## 2024年4月18日（その2）

### コミット: チェックイン案内設定ページを削除

- 変更内容:
  - `admin/guidance_settings.php`ファイルを削除
  - サイドバーメニューから「チェックイン案内設定」項目を削除
  
- 問題: 
  - QRコードスキャン後のフローを変更したことで「チェックイン案内」という概念が不要になった
  - 席次情報管理とスケジュール管理が専用ページと重複していた
  - 同じ機能が複数の場所に存在し、管理が煩雑になっていた
  
- 解決策:
  - 機能重複を解消するため、機能が重複していたページを削除
  - 席次情報は`seating.php`で一元管理
  - スケジュール情報は`schedule.php`で一元管理
  - データベース上では`schedule`テーブルに統一済み

- 目的: 管理インターフェースの簡略化と、メンテナンス性の向上

# 2025/04/19 (マージ) - QRコードスキャン後の封筒アニメーションスキップ機能追加

コミットID: （マージ後に記入）
作成者: 村岡翔
コミット日時: 2025年4月19日

## 変更内容
- `js/envelope.js`ファイルの改修
  - QRコードスキャン後に自動で封筒を開く機能を実装
  - URLパラメータ「checkin_complete」を検出して自動移行するよう修正
  - スクロール処理や遅延表示など、UXを向上させる細かな調整を追加

## 目的
QRコードスキャン後、ゲストが再度封筒をタップする手間を省き、より滑らかな体験を提供する。
自動的に招待状コンテンツが表示されることで、利便性が向上し、操作性の問題を解決する。

# 2025/04/16 - チェックイン状態を記憶する機能の追加

コミットID: bd94f70
作成者: 村岡翔
コミット日時: 2025年4月16日

## 変更内容
- `js/envelope.js`ファイルの改修
  - チェックイン状態をlocalStorageに保存する機能を追加
  - 再訪問時に保存されたチェックイン状態を確認し、封筒アニメーションをスキップ
  - ブラウザの再読み込みやリンクからの再訪問時にも状態を維持
- `index.php`ファイルの改修
  - QRコードスキャン後、必ずcheckin_complete=1パラメータを含むURLにリダイレクト
  - チェックイン状態の一貫性を確保

## 目的
チェックイン済みのゲストが再度サイトを訪問した際に、毎回封筒アニメーションが表示される問題を解決する。
QRコードスキャン後の体験をより一貫性のあるものにし、ユーザビリティを向上させる。

# 2025/04/16（その2） - データベースのチェックイン履歴との連携機能追加

コミットID: fb1ca52
作成者: 村岡翔
コミット日時: 2025年4月16日

## 変更内容
- `index.php`ファイルの改修
  - グループIDでアクセスした際に、データベースでそのグループのチェックイン履歴を確認
  - チェックイン済みなら自動的に`checkin_complete=1`パラメータを付与するリダイレクト処理を追加
  - 異なるデバイスやブラウザでもチェックイン状態を共有可能に

- `js/envelope.js`ファイルの改修
  - ローカルストレージのデータ形式を改善し、タイムスタンプと有効期限を追加
  - チェックイン状態の有効期限を60日間に設定
  - 旧形式のデータも自動的に新形式に移行する互換性対応

## 目的
異なるデバイスやブラウザでアクセスした場合でも、チェックイン済みのゲストに一貫した体験を提供する。
データベースに記録されたチェックイン履歴を活用し、サイト訪問時の使い勝手を向上させる。